<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sophie Chowgule">

<title>Law of total probability and Bayes’ theorem – STARMAST</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L30GVCTC8L"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-L30GVCTC8L', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":"",
"website_privacy_policy_url":"cookies.qmd"
  ,
"language":"en"
  });
});
</script> 
  
<script>
  window.addEventListener('load', function() {
    document.getElementById("cc-nb-title").innerHTML = "Your privacy is important to us";
    document.getElementById("cc-nb-text").innerHTML = "This website uses Google Analytics to measure traffic to and from the site, and to learn where our users come from. We use cookies to enable this service, alongside enabling our non-identifiable QuickCheck problem tracking. These are the sole purposes of enabling cookies on this website.";
  });
</script>

<script src="https://www.desmos.com/api/v1.11/calculator.js?apiKey=2949896c7db64d4a8a380b1e11254b5f"></script>
<!-- Mailerlite snippet -->
 <script>
    (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
    .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
    n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
    (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
    ml('account', '1477275');
</script>

<script src="https://esm.sh/shinylive-r"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../webexfiles/webex.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STARMAST</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../newsindex.html"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../fullindex.html"> 
<span class="menu-text">Full index</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../studyguidelist.html"> 
<span class="menu-text">Study guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../olist.html"> 
<span class="menu-text">Other resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../applist.html"> 
<span class="menu-text">Apps</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.instagram.com/starmast_"> 
<span class="menu-text">Instagram</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <div id="quarto-announcement" data-announcement-id="5d82c5223afdc6fc2c5d907ddbb3174b" class="alert alert-success hidden"><i class="bi bi-database-add quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p><strong>Latest content:</strong> Six new factsheets on calculus, trigonometry, and hyperbolic functions! (22/08/25)</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#law-of-total-probability" id="toc-law-of-total-probability" class="nav-link" data-scroll-target="#law-of-total-probability">Law of total probability</a></li>
  <li><a href="#bayes-theorem" id="toc-bayes-theorem" class="nav-link" data-scroll-target="#bayes-theorem">Bayes’ theorem</a></li>
  <li><a href="#quick-check-problems" id="toc-quick-check-problems" class="nav-link" data-scroll-target="#quick-check-problems">Quick check problems</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further reading</a>
  <ul class="collapse">
  <li><a href="#version-history-and-licensing" id="toc-version-history-and-licensing" class="nav-link" data-scroll-target="#version-history-and-licensing">Version history and licensing</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="bayestheorem.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="bayestheorem.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Law of total probability and Bayes’ theorem</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Probability</div>
    <div class="quarto-category">Statistics</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sophie Chowgule </p>
          </div>
  </div>
    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Summary</div>
    The law of total probability and Bayes’ theorem build on the fundamentals of conditional probability. They are used to calculate probabilities across different scenarios and to update predictions when information is incomplete. This guide outlines both methods and explains how and when to apply them.
  </div>
</div>


</header>


<p><em>Before reading this guide, it is highly recommended that you read <a href="../studyguides/conditionalprobability.html">Guide: Conditional probability</a>.</em></p>
<table><tbody><tr><td style="vertical-align: middle"><strong>Narration of study guide:</strong>&nbsp;&nbsp;</td><td><audio controls=""><source src="./Narrations/bayestheorem.mp3" type="audio/mpeg">Your browser does not support the audio element.</audio></td></tr></tbody></table>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The law of total probability and Bayes’ theorem extend the basic ideas of conditional probability. They provide a way to calculate probabilities when outcomes depend on multiple possible scenarios or when information is incomplete or indirect. These results are widely used across statistics, particularly in problems involving uncertainty, prediction, and statistical inference. This guide introduces both the law of total probability and Bayes’ theorem, explains how they are derived, and shows how to apply them in practical contexts.</p>
</section>
<section id="law-of-total-probability" class="level1">
<h1>Law of total probability</h1>
<p>In everyday life, an event can often happen in more ways than one. For example, the chance that a package arrives late might depend on whether it is delivered by courier A or courier B. If each courier is used for a different proportion of deliveries, and each one has a different chance of causing a delay, then the overall chance of delay depends on both which courier is used and how often each one is chosen.</p>
<p>The <strong>law of total probability</strong> allows you to calculate the total probability of an event by combining its conditional probabilities across several possible scenarios. This approach is especially helpful when outcomes depend on <strong>mutually exclusive</strong> events (only one possible scenario can occur at a time), each with a known probability.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition of the law of total probability
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose an event <span class="math inline">\(B\)</span> depends on several possible scenarios. These scenarios can be described by events <span class="math inline">\(A_1,A_2,\ldots, A_n\)</span>, that are:</p>
<ul>
<li><strong>Mutually exclusive</strong>: they cannot occur at the same time, and</li>
<li><strong>Exhaustive</strong>: one of them must always occur.</li>
</ul>
<p>Then, the <strong>law of total probability</strong> states that the probability of event <span class="math inline">\(B\)</span> is:</p>
<p><span class="math display">\[
\mathbb{P}(B) = \sum_{i=1}^{n} \mathbb{P}(A_i) \mathbb{P}(B \mid A_i)
\]</span> Each term represents the probability of <span class="math inline">\(B\)</span> in one particular scenario.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The symbol <span class="math inline">\(\sum\)</span> is called <strong>sigma notation</strong>. In this case, it is adding the probabilities for each possible scenario where <span class="math inline">\(B\)</span> could happen. For more, see <a href="../studyguides/sigmanotation.html">Guide: Sigma notation</a>.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To apply the law of total probability:</p>
<ol type="1">
<li>Calculate each scenario’s conditional probability, <span class="math inline">\(\mathbb{P}(B \mid A_i)\)</span>.</li>
<li>Multiply these conditional probabilities by their scenario likelihoods, <span class="math inline">\(\mathbb{P}(A_i)\)</span>.</li>
<li>Add these results to find the total probability of event <span class="math inline">\(B\)</span>.</li>
</ol>
<p>This accounts for each possible scenario exactly once.</p>
</div>
</div>
<p>For more about why the law of total probability is true, please go to <a href="../proofsheets/ps-bayestheorem.html">Proof: Law of total probability and Bayes’ theorem</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The examples that follow all stick to a certain pattern, which can be summarized as follows:</p>
<ul>
<li>Information about probabilities</li>
<li>Renaming of events and probabilities into mathematical terms</li>
<li>Application of the formula</li>
</ul>
<p>This standard pattern is a useful framework for you to produce answers to these questions. It’s important to have clarity in what information you have and what information you are trying to work out.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>At a hospital:</p>
<ul>
<li><span class="math inline">\(70\%\)</span> of patients are treated in the general ward,<br>
</li>
<li><span class="math inline">\(30\%\)</span> of patients are treated in the emergency unit,<br>
</li>
<li>The probability a patient in the general ward recovers in <span class="math inline">\(2\)</span> days is <span class="math inline">\(0.8\)</span>.</li>
<li>The probability a patient in the emergency unit recovers in <span class="math inline">\(2\)</span> days is <span class="math inline">\(0.6\)</span>.</li>
</ul>
<p>What is the probability that a randomly selected patient recovers in 2 days?</p>
<p>Let <span class="math inline">\(B\)</span> be the event the patient recovers in <span class="math inline">\(2\)</span> days. Let <span class="math inline">\(A_G\)</span> be the event they are treated in the general ward, and <span class="math inline">\(A_E\)</span> in the emergency unit.</p>
<p>You know:</p>
<ul>
<li><span class="math inline">\(\mathbb{P}(A_G) = 0.7\)</span>,<br>
</li>
<li><span class="math inline">\(\mathbb{P}(A_E) = 0.3\)</span>,<br>
</li>
<li><span class="math inline">\(\mathbb{P}(B \mid A_G) = 0.8\)</span>,<br>
</li>
<li><span class="math inline">\(\mathbb{P}(B \mid A_E) = 0.6\)</span>.</li>
</ul>
<p>You want to find <span class="math inline">\(\mathbb{P}(B)\)</span>. Using the law of total probability:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{P}(B) &amp;= \mathbb{P}(A_G)\mathbb{P}(B\mid A_G) + \mathbb{P}(A_E)\mathbb{P}(B\mid A_E)\\[0.5em] &amp;= (0.7)(0.8) + (0.3)(0.6)\\[0.5em] &amp;= 0.56 + 0.18 = 0.74
\end{aligned}
\]</span></p>
<p>So the probability that a randomly selected patient recovers in <span class="math inline">\(2\)</span> days is <span class="math inline">\(0.74\)</span>, or <span class="math inline">\(74\%\)</span>.</p>
</div>
</div>
<p>You don’t have to write quite so much in your final explanation using the law of total probability; see the next example for more.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>A group of students can choose to study in three different locations; a local library, a cafe, or at home. The students were surveyed, and it was found that students work:</p>
<ul>
<li><span class="math inline">\(50\%\)</span> of the time in the library,<br>
</li>
<li><span class="math inline">\(30\%\)</span> of the time in a café,</li>
<li><span class="math inline">\(20\%\)</span> of the time home.</li>
</ul>
<p>Research has indicated that students concentrate well:</p>
<ul>
<li><span class="math inline">\(90\%\)</span> of the time in the library,<br>
</li>
<li><span class="math inline">\(60\%\)</span> of the time in the café,<br>
</li>
<li><span class="math inline">\(40\%\)</span> of the time at home.</li>
</ul>
<p>What is the probability that a random student concentrates well on any given day?</p>
<p>Let <span class="math inline">\(B\)</span> be the event the student concentrates well. Let <span class="math inline">\(A_L\)</span>, <span class="math inline">\(A_C\)</span>, and <span class="math inline">\(A_H\)</span> be the events that the student studies in the library, café, and home, respectively.</p>
<p>You know from above that</p>
<ul>
<li><span class="math inline">\(\mathbb{P}(A_L) = 0.5\)</span> and <span class="math inline">\(\mathbb{P}(B \mid A_L) = 0.9\)</span><br>
</li>
<li><span class="math inline">\(\mathbb{P}(A_C) = 0.3\)</span> and <span class="math inline">\(\mathbb{P}(B \mid A_C) = 0.6\)</span><br>
</li>
<li><span class="math inline">\(\mathbb{P}(A_H) = 0.2\)</span> and <span class="math inline">\(\mathbb{P}(B \mid A_H) = 0.4\)</span></li>
</ul>
<p>You want to find <span class="math inline">\(\mathbb{P}(B)\)</span>. Using the law of total probability:</p>
<p><span class="math display">\[
\mathbb{P}(B) = (0.5)(0.9) + (0.3)(0.6) + (0.2)(0.4) = 0.45 + 0.18 + 0.08 = 0.71
\]</span></p>
<p>So, the probability that the student concentrates well on any given day is <span class="math inline">\(0.71\)</span>, or <span class="math inline">\(71\%\)</span>.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>At Cantor’s Confectionery the customer service team receives emails from three types of senders:</p>
<ul>
<li><span class="math inline">\(40\%\)</span> of the time from satisfied customers,<br>
</li>
<li><span class="math inline">\(35\%\)</span> from important suppliers,<br>
</li>
<li><span class="math inline">\(25\%\)</span> from dissatisfied customers (who detest mathematics and statistics).</li>
</ul>
<p>The chance of an email containing a typo is:</p>
<ul>
<li><span class="math inline">\(5\%\)</span> for satisfied customer emails,<br>
</li>
<li><span class="math inline">\(2\%\)</span> for important supplier emails,<br>
</li>
<li><span class="math inline">\(8\%\)</span> for dissatisfied customer emails.</li>
</ul>
<p>What is the probability that a randomly selected email contains a typo?</p>
<p>Let <span class="math inline">\(B\)</span> be the event that the email contains a typo. Let <span class="math inline">\(A_S\)</span>, <span class="math inline">\(A_I\)</span>, and <span class="math inline">\(A_D\)</span> represent the sender: satisfied customer, important supplier, or dissatisfied customer.</p>
<p>You know:</p>
<ul>
<li><span class="math inline">\(\mathbb{P}(A_S) = 0.4\)</span> and <span class="math inline">\(\mathbb{P}(B \mid A_S) = 0.05\)</span><br>
</li>
<li><span class="math inline">\(\mathbb{P}(A_I) = 0.35\)</span> and <span class="math inline">\(\mathbb{P}(B \mid A_I) = 0.02\)</span><br>
</li>
<li><span class="math inline">\(\mathbb{P}(A_D) = 0.25\)</span> and <span class="math inline">\(\mathbb{P}(B \mid A_D) = 0.08\)</span></li>
</ul>
<p>You want to find <span class="math inline">\(\mathbb{P}(B)\)</span>. Using the law of total probability:</p>
<p><span class="math display">\[
\mathbb{P}(B) = (0.4)(0.05) + (0.35)(0.02) + (0.25)(0.08) = 0.02 + 0.007 + 0.02 = 0.047
\]</span></p>
<p>So, the probability that an incoming email contains a typo is <span class="math inline">\(0.047\)</span>, or <span class="math inline">\(4.7\%\)</span>.</p>
</div>
</div>
</section>
<section id="bayes-theorem" class="level1">
<h1>Bayes’ theorem</h1>
<p>Often, the probability of one event given another is known, but the reverse is needed.</p>
<p>For instance, suppose that Cantor’s Confectionery has three candy machines <span class="math inline">\(A,B,C\)</span>, and that you know the probability of a bad-tasting candy being made given you know which machine made it. Suppose you wanted to know there <strong>reverse</strong> conditional probability; given that you have a bad tasting candy, what is the probability that machine <span class="math inline">\(C\)</span> is responsible? (See Example 6 below.)</p>
<p><strong>Bayes’ theorem</strong> lets you reverse conditional probabilities, calculating the probability of event <span class="math inline">\(A\)</span> given event <span class="math inline">\(B\)</span>, based on the probability of <span class="math inline">\(B\)</span> given <span class="math inline">\(A\)</span>.</p>
<p>Bayes’ Theorem is especially useful for updating predictions as new information becomes available and when it is difficult to calculate probabilities directly. It is used in such diverse areas as medicine, manufacturing, and even game shows (see Example 7).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Statement of Bayes’ theorem
</div>
</div>
<div class="callout-body-container callout-body">
<p>If <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are events with <span class="math inline">\(\mathbb{P}(B) &gt; 0\)</span>, then <strong>Bayes’ theorem</strong> states:</p>
<p><span class="math display">\[
\mathbb{P}(A \mid B) = \dfrac{\mathbb{P}(B \mid A) \mathbb{P}(A)}{\mathbb{P}(B)}.
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mathbb{P}(A \mid B)\)</span> is the probability of <span class="math inline">\(A\)</span> given <span class="math inline">\(B\)</span>,</li>
<li><span class="math inline">\(\mathbb{P}(B \mid A)\)</span> is the probability of <span class="math inline">\(B\)</span> given <span class="math inline">\(A\)</span>,</li>
<li><span class="math inline">\(\mathbb{P}(A)\)</span> and <span class="math inline">\(\mathbb{P}(B)\)</span> are the individual probabilities of <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, respectively.</li>
</ul>
</div>
</div>
<p>For more about why the Bayes’ theorem is true, please go to <a href="../proofsheets/ps-bayestheorem.html">Proof: Law of total probability and Bayes’ theorem</a>.</p>
<p>Here are some examples about how to use Bayes’ theorem, including one which could win you a <strong>car</strong>! (Important notice: STARMAST will not give you a car.)</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>A library survey found:</p>
<ul>
<li><span class="math inline">\(15\%\)</span> of people regularly borrow mystery books.</li>
<li>Of people who regularly borrow mystery books, <span class="math inline">\(80\%\)</span> also borrow science fiction books.</li>
<li>In general, <span class="math inline">\(40\%\)</span> of people regularly borrow science fiction books.</li>
</ul>
<p>A person is randomly selected and found to regularly borrow science fiction books. What is the probability they also regularly borrow mystery books?</p>
<p>To answer this question, you could use Bayes’ theorem. First of all, define the events using mathematical notations:</p>
<ul>
<li><span class="math inline">\(M\)</span>: A student regularly borrows mystery books.</li>
<li><span class="math inline">\(S\)</span>: A student regularly borrows science fiction books.</li>
</ul>
<p>You know from the given information above that</p>
<ul>
<li><span class="math inline">\(\mathbb{P}(M) = 0.15\)</span>,</li>
<li><span class="math inline">\(\mathbb{P}(S) = 0.40\)</span>,</li>
<li><span class="math inline">\(\mathbb{P}(S \mid M) = 0.80\)</span>.</li>
</ul>
<p>You want to work out <span class="math inline">\(\mathbb{P}(M\mid S)\)</span>, which is the probability they they regularly borrow science fiction given that they regularly borrow mystery books. So applying Bayes’ theorem gives:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{P}(M \mid S) &amp;= \dfrac{\mathbb{P}(S \mid M)\mathbb{P}(M)}{\mathbb{P}(S)}\\[0.5em] &amp;= \dfrac{(0.80)(0.15)}{0.40} = 0.30
\end{aligned}
\]</span></p>
<p>So, given the person borrows science fiction books regularly, there is a <span class="math inline">\(30\%\)</span> chance they also regularly borrow mystery books.</p>
</div>
</div>
<p>Here’s an example that combines both Bayes’ theorem and the law of total probability.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 5
</div>
</div>
<div class="callout-body-container callout-body">
<p>Commuters to work at Cantor’s Confectionery choose transport as follows:</p>
<ul>
<li><span class="math inline">\(60\%\)</span> travel by bus</li>
<li><span class="math inline">\(40\%\)</span> travel by car.</li>
</ul>
<p>But there are some problems:</p>
<ul>
<li>Bus commuters are late <span class="math inline">\(25\%\)</span> of the time.</li>
<li>Car commuters are late <span class="math inline">\(10\%\)</span> of the time.</li>
</ul>
<p>As a high-ranking manager in Cantor’s confectionery, you are a little annoyed at the constant lateness and want to do some research. You randomly select a commuter who arrived late today, and want to find out the probability that they commuted by bus.</p>
<p>First, you could define the events as follows</p>
<ul>
<li><span class="math inline">\(B\)</span>: Commuter travels by bus.</li>
<li><span class="math inline">\(C\)</span>: Commuter travels by car.</li>
<li><span class="math inline">\(L\)</span>: Commuter arrives late.</li>
</ul>
<p>You know <span class="math inline">\(\mathbb{P}(B) = 0.6\)</span>, and <span class="math inline">\(\mathbb{P}(C) = 0.4\)</span>; you also know that <span class="math inline">\(\mathbb{P}(L\mid B) = 0.2\)</span> and <span class="math inline">\(\mathbb{P}(L\mid C) = 0.1\)</span>. You want to work out <span class="math inline">\(\mathbb{P}(B\mid L)\)</span> using Bayes’ theorem. In order to use Bayes’ theorem, you will need to know <span class="math inline">\(\mathbb{P}(L)\)</span>, which you <strong>don’t</strong> know.</p>
<p>Thankfully, this can be worked out using the law of total probability. Doing this gives</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{P}(L) &amp;= \mathbb{P}(L \mid B)\mathbb{P}(B) + \mathbb{P}(L \mid C)\mathbb{P}(C)\\[0.5em]
&amp;= (0.25)(0.60) + (0.10)(0.40) = 0.15 + 0.04 = 0.19
\end{aligned}
\]</span></p>
<p>Now you can use Bayes’ theorem to get</p>
<p><span class="math display">\[
\mathbb{P}(B \mid L) = \dfrac{\mathbb{P}(L \mid B)\mathbb{P}(B)}{\mathbb{P}(L)} = \dfrac{(0.25)(0.60)}{0.19} \approx 0.7895
\]</span> So given the commuter arrived late, there’s about a <span class="math inline">\(79\%\)</span> chance they commute by bus. Time to suggest earlier buses!</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 6
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cantor’s Confectionery uses three machines to make some of its delicious sweets. There are creatively named Machines A, B, C. Here are their vital statistics.</p>
<ul>
<li>Machine A produces <span class="math inline">\(50\%\)</span> of the items and has a <span class="math inline">\(2\%\)</span> defect rate,<br>
</li>
<li>Machine B produces <span class="math inline">\(30\%\)</span> of the items and has a <span class="math inline">\(5\%\)</span> defect rate,<br>
</li>
<li>Machine C produces <span class="math inline">\(20\%\)</span> of the items and has a <span class="math inline">\(10\%\)</span> defect rate.</li>
</ul>
<p>You select an item at random and find that it is defective. What is the probability that it was made by Machine C?</p>
<p>Once again, the first thing to do is to give the events names. Let:</p>
<ul>
<li><span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span> be the events that the item came from Machine A, B, or C,<br>
</li>
<li><span class="math inline">\(D\)</span> be the event that the item is defective.</li>
</ul>
<p>You know from above that</p>
<ul>
<li><span class="math inline">\(\mathbb{P}(A) = 0.5\)</span>, <span class="math inline">\(\mathbb{P}(B) = 0.3\)</span>, <span class="math inline">\(\mathbb{P}(C) = 0.2\)</span>,<br>
</li>
<li><span class="math inline">\(\mathbb{P}(D \mid A) = 0.02\)</span>, <span class="math inline">\(\mathbb{P}(D \mid B) = 0.05\)</span>, <span class="math inline">\(\mathbb{P}(D \mid C) = 0.10\)</span>.</li>
</ul>
<p>You want to find <span class="math inline">\(\mathbb{P}(C\mid D)\)</span>. To do this, you need <span class="math inline">\(\mathbb{P}(D)\)</span> which you don’t know, but you can work out using the law of total probability. Doing this gives</p>
<p><span class="math display">\[
\mathbb{P}(D) = (0.02)(0.5) + (0.05)(0.3) + (0.10)(0.2) = 0.01 + 0.015 + 0.02 = 0.045
\]</span></p>
<p>Now you can apply Bayes’ theorem to get:</p>
<p><span class="math display">\[
\mathbb{P}(C \mid D) = \dfrac{\mathbb{P}(D \mid C)\mathbb{P}(C)}{\mathbb{P}(D)} = \dfrac{(0.10)(0.20)}{0.045} \approx 0.444
\]</span></p>
<p>So, given that the item is defective, there is about a 44% chance it came from Machine C. Time to get some maintenance!</p>
</div>
</div>
<p>Finally, here’s an example of how to use Bayes’ theorem to solve a <em>very</em> famous real life problem from a very real TV game show.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 7 (Monty Hall)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here’s the situation:</p>
<ul>
<li>In the climax of a game show, there are three doors <span class="math inline">\(A,B,C\)</span>.</li>
<li>Behind one of the doors is a fantastic new car; behind the other two are goats. The host knows what lies behind each door.</li>
<li>You are encouraged to select a door to try and win the car, and you make an initial choice of door.</li>
<li>Before your chosen door is opened, the host then opens <em>another</em> door, revealing a goat.</li>
<li>The host then asks you if you want to switch your door.</li>
<li>The question is: <strong>should you switch your door</strong>?</li>
</ul>
<p>Once again, this is an application of Bayes’ theorem, even if it doesn’t look like it to begin with.</p>
<p>To begin with, write <span class="math inline">\(\textsf{Car}_A, \textsf{Car}_B, \textsf{Car}_C\)</span> for the events that the car is behind doors <span class="math inline">\(A,B,C\)</span> respectively. At the start, <span class="math display">\[\mathbb{P}(\textsf{Car}_A) =  \mathbb{P}(\textsf{Car}_B) =  \mathbb{P}(\textsf{Car}_C) = \dfrac{1}{3}.\]</span></p>
<p>For the maths involved in what follows, your initial choice of door is not important; the maths will be the same if you relabelled all doors. (This is known as <strong>without loss of generality</strong>.) So assume you pick door <span class="math inline">\(A\)</span>.</p>
<p>This means that the host has a choice of two doors to open; either <span class="math inline">\(B\)</span> or <span class="math inline">\(C\)</span>. There will be a goat behind whichever door they pick. The events of the host opening door <span class="math inline">\(B\)</span> and <span class="math inline">\(C\)</span> can be written as <span class="math inline">\(\textsf{O}_B, \textsf{O}_C\)</span>. You can now work out some conditional probabilities.</p>
<ul>
<li><p>If the car is behind door <span class="math inline">\(A\)</span>, then the host has an equal chance to pick either door <span class="math inline">\(B\)</span> or door <span class="math inline">\(C\)</span>. Therefore <span class="math display">\[\mathbb{P}(\textsf{O}_B\mid \textsf{Car}_A) = \mathbb{P}(\textsf{O}_C\mid \textsf{Car}_A) = \frac{1}{2}.\]</span></p></li>
<li><p>If the car is behind door <span class="math inline">\(B\)</span>, then the host cannot pick door <span class="math inline">\(B\)</span> to open as that would reveal the car; they cannot pick door <span class="math inline">\(A\)</span> as you chose it. So they must pick door <span class="math inline">\(C\)</span> to open, which means that <span class="math display">\[\mathbb{P}(\textsf{O}_B\mid \textsf{Car}_B) = 0 \quad\textsf{ and }\quad \mathbb{P}(\textsf{O}_C\mid \textsf{Car}_B) = 1.\]</span></p></li>
<li><p>Similarly, if the car is behind door <span class="math inline">\(C\)</span>, then the host cannot pick door <span class="math inline">\(C\)</span> to open as that would reveal the car; they cannot pick door <span class="math inline">\(A\)</span> as you chose it. So they must pick door <span class="math inline">\(B\)</span> to open, which means that <span class="math display">\[\mathbb{P}(\textsf{O}_B\mid \textsf{Car}_B) = 1 \quad\textsf{ and }\quad \mathbb{P}(\textsf{O}_C\mid \textsf{Car}_B) = 0.\]</span></p></li>
</ul>
<p>So, the question is <strong>should you switch to the new door or should you stick with the original choice</strong>? This means working out the probability of where the car is given that you know which door the host opens, which is a perfect use of Bayes’ theorem.</p>
<p>As your original choice of door didn’t matter for the maths, the choice of which door to open by the host doesn’t matter either; let’s say that the host opens door <span class="math inline">\(B\)</span>. However, you don’t yet know <span class="math inline">\(\mathbb{P}(\textsf{O}_B)\)</span>, which is needed for Bayes’ theorem. Using the law of total probability, you can write that</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{P}(\textsf{O}_B) &amp;= \mathbb{P}(\textsf{O}_B\mid \textsf{Car}_A)\mathbb{P}(\textsf{Car}_A) + \mathbb{P}(\textsf{O}_B\mid \textsf{Car}_B)\mathbb{P}(\textsf{Car}_B) + \mathbb{P}(\textsf{O}_B\mid \textsf{Car}_C)\mathbb{P}(\textsf{Car}_C)\\[0.5em]
&amp;= \left(\frac{1}{2}\right)\left(\frac{1}{3}\right) + \left(0\right)\left(\frac{1}{3}\right) + \left(1\right)\left(\frac{1}{3}\right)\\[0.5em] &amp;= \frac{1}{6} + \frac{1}{3} = \frac{1}{2}
\end{aligned}
\]</span></p>
<p>You can now work out the conditional probabilities of the car being behind doors <span class="math inline">\(A,C\)</span> given that the host opens door <span class="math inline">\(B\)</span>:</p>
<ul>
<li><p>Here, you are working out <span class="math inline">\(\mathbb{P}(\textsf{Car}_A\mid \textsf{O}_B)\)</span>, which by Bayes’ theorem is <span class="math display">\[\begin{aligned}\mathbb{P}(\textsf{Car}_A\mid \textsf{O}_B) &amp;= \frac{\mathbb{P}(\textsf{O}_B\mid \textsf{Car}_A)\mathbb{P}(\textsf{O}_B)}{\mathbb{P}(\textsf{Car}_A)}\\[0.5em] &amp;= \frac{(1/2)(1/3)}{(1/2)} = \frac{1}{3}\end{aligned}\]</span></p></li>
<li><p>Finally, you are working out <span class="math inline">\(\mathbb{P}(\textsf{Car}_C\mid \textsf{O}_B)\)</span>, which by Bayes’ theorem is <span class="math display">\[\begin{aligned}\mathbb{P}(\textsf{Car}_C\mid \textsf{O}_B) &amp;= \frac{\mathbb{P}(\textsf{O}_B\mid \textsf{Car}_C)\mathbb{P}(\textsf{O}_B)}{\mathbb{P}(\textsf{Car}_C)}\\[0.5em] &amp;= \frac{(1)(1/3)}{(1/2)} = \frac{2}{3}\end{aligned}\]</span></p></li>
</ul>
<p>So, the probability of winning if you stick with door <span class="math inline">\(A\)</span> is <span class="math inline">\(1/3\)</span>, but the probability of winning if you switch to door <span class="math inline">\(C\)</span> is <span class="math inline">\(2/3\)</span>! You are <strong>twice as likely to win the car if you switch doors</strong>.</p>
<p>Of course (with credit to <a href="xkcd.com">xkcd</a>), the real prize might not be the car…</p>
<p>&nbsp;</p>
<p><img src="FiguresPNG/montyhallxkcd.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="quick-check-problems" class="level1">
<h1>Quick check problems</h1>
<div class="webex-check webex-box" data-topic="TPBT1">
<p>In the following questions, enter your answers as decimal numbers rounded to 2 decimal places.</p>
<ol type="1">
<li>A hospital treats patients in two wards:</li>
</ol>
<ul>
<li>80% in the general ward, 20% in emergency<br>
</li>
<li>Recovery rates within 2 days are 70% (general) and 50% (emergency)</li>
</ul>
<p>What is the probability a randomly selected patient recovers in 2 days?<br>
<input class="webex-solveme nospaces" size="4" data-answer="[&quot;0.66&quot;]"></p>
<ol start="2" type="1">
<li>A student studies:</li>
</ol>
<ul>
<li>60% in the library, 30% in a café, 10% at home<br>
</li>
<li>Concentration rates are 90%, 60%, and 40%, respectively</li>
</ul>
<p>What is the probability that the student concentrates well on a given day?<br>
<input class="webex-solveme nospaces" size="4" data-answer="[&quot;0.76&quot;]"></p>
<ol start="3" type="1">
<li>After your investigation into commuters to Cantor’s Confectionery, you receive a new set of statistics:</li>
</ol>
<ul>
<li>40% commute by bus, 60% by car<br>
</li>
<li>Bus lateness: 10%, Car lateness: 20%</li>
</ul>
<p>A commuter is late. What is the probability they took the bus?<br>
<input class="webex-solveme nospaces" size="4" data-answer="[&quot;0.25&quot;]"></p>
<ol start="4" type="1">
<li>As discussed above above, Cantor’s Confectionery has 3 machines with the following statistics:</li>
</ol>
<ul>
<li>A: 50% of production, 2% defect rate<br>
</li>
<li>B: 30%, 5% defect<br>
</li>
<li>C: 20%, 10% defect</li>
</ul>
<p>If an item is defective, what is the probability it came from Machine A?<br>
<input class="webex-solveme nospaces" size="4" data-answer="[&quot;0.22&quot;]"></p>
<ol start="5" type="1">
<li>True or false:</li>
</ol>
<ol type="a">
<li><p>The law of total probability can only be used when events are mutually exclusive and exhaustive.<br>
<select class="webex-select"><option value="blank"></option><option value="answer">TRUE</option><option value="">FALSE</option></select></p></li>
<li><p>Bayes’ Theorem allows reversing conditional probabilities.<br>
<select class="webex-select"><option value="blank"></option><option value="answer">TRUE</option><option value="">FALSE</option></select></p></li>
<li><p>The law of total probability requires <span class="math inline">\(\mathbb{P}(B \mid A_i)\)</span> for every outcome.<br>
<select class="webex-select"><option value="blank"></option><option value="answer">TRUE</option><option value="">FALSE</option></select></p></li>
</ol>
</div>
</section>
<section id="further-reading" class="level1 unnumbered">
<h1 class="unnumbered">Further reading</h1>
<p><a href="../questions/qs-bayestheorem.html">For more questions on the subject, please go to Questions: Law of total probability and Bayes’ theorem.</a></p>
<section id="version-history-and-licensing" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="version-history-and-licensing">Version history and licensing</h2>
<p>v1.0: initial version created 05/25 by Sophie Chowgule as part of a University of St Andrews VIP project.</p>
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1">This work is licensed under CC BY-NC-SA 4.0.</a></p>


</section>
</section>

</main> <!-- /main -->
<script>

/* once a quickcheck is completed, we pass in the topic id and concatenate it into a quickcheck (qc) id
   and store that in local storage to persist across webpages so we know which topics have been completed */
function markTopicCompleted(topicId) {
  if (!topicId || typeof topicId !== 'string') { console.error('Invalid topicId:', topicId); return; }
  
  const storageKey = 'qc-completed-' + topicId;
  localStorage.setItem(storageKey, 'true');
  console.log(`Marked ${topicId} as completed (key: ${storageKey})`);
  
  updateTopicStatus(topicId); 
}

/* select all elements related to a certain topic, then check by fetching from local storage 
   whether the corresponding qc-id is marked as true for completed, or false for uncompleted 
   if so, add the "completed" css class id, for webex.css to update from a red cross to a green tick */
function updateTopicStatus(topicId) {
  const elements = document.querySelectorAll(`[data-topic="${topicId}"]`);
  const isCompleted = localStorage.getItem(`qc-completed-${topicId}`) === 'true';
  
  elements.forEach(el => {
    if (isCompleted) el.classList.add("completed");
    else el.classList.remove("completed");
  })

  console.log(`Updated UI for ${topicId}:`, isCompleted);
}

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");
  let allCorrect = false;

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) 
  {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
    if (correct === (solvemes + radiogroups + selects) && correct > 0) allCorrect = true;
  }

  if (allCorrect) // get the data-topic id for guide that just had its quick check problem fully completed and pass into chain of functions
  {
    const quickCheck = document.querySelector(".webex-check");
    const topicId = quickCheck?.getAttribute("data-topic");
    if (topicId) markTopicCompleted(topicId);
  }
}

/* used to identify each data topic element (on fullindex.html and each guide) and update the red cross to a green tick
   based on whether the corresponding quickcheck problem(s) have been completed for each respective guide */
function initializeAllTopics() {
  document.querySelectorAll('[data-topic]').forEach(el => {
    const topicId = el.getAttribute('data-topic');
    updateTopicStatus(topicId);
  });
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) cl.remove("open");
  else cl.add("open");
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) my_answer = my_answer.toLowerCase();
  if (cl.contains("nospaces")) my_answer = my_answer.replace(/ /g, "");

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if (this.dataset.tol > 0)
  {
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) cl.add("webex-correct");
    else cl.remove("webex-correct");
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) cl.add("webex-correct");
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") cl.add("webex-correct");
  else if (this.value != "blank") cl.add("webex-incorrect");

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") cl.add("webex-correct");
  else cl.add("webex-incorrect");

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++)
    if (buttons[i].parentElement.classList.contains('webex-solution')) buttons[i].onclick = b_func;

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);

  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) real_answer = real_answer.toLowerCase();
    if (cl.contains("nospaces")) real_answer = real_answer.replace(/ /g, "");
  
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) radiogroups[i].onchange = radiogroups_func;

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* check each question to see whether it was answered correctly */
  update_total_correct();

  /* check each data-topic element and update from cross to tick if 
    corresponding quick check problem has been fully completed */
  initializeAllTopics();

  /* listens for storage updates, extracts topic id from qc-id, and updates UI through topic id  */
  window.addEventListener('storage', (changeDetails) => {
    if (changeDetails.key?.startsWith('qc-completed-')) 
    {
      const topicId = changeDetails.key.replace('qc-completed-', '');
      updateTopicStatus(topicId);
    }
  });
}

</script>
<!--------------------  Email Forms -----------------------------------
        Compiled into each .html page by Quarto.
        Website hosted and form handled by Netlify now
        Mailing list provided by mailerlite
        Input verified by reCaptcha2 
        
        Authors (recent to latest): 
           Tristin Doherty (Trido)
           Mohit Agarwal (Mohit-Agarwa1)
--------------------------------------------------------------------->
<script>
  // Adds an extra layer of validation to aid user input,
  // some of these are covered by basic html form validations as well, but netlify handles everything else
  document.addEventListener("DOMContentLoaded", function() {
    const form = document.querySelector("form[name='feedback']"); 
    
    form.addEventListener("submit", function(event) {
        const nameInput = document.querySelector("input[name='name']")?.value.trim();
        const emailInput = document.querySelector("input[name='email']")?.value.trim(); 
        const feedbackInput = document.querySelector("textarea[name='feedback']")?.value.trim();

        if (!nameInput)    { alert("Please enter a name."); return; }
        if (!emailInput)   { alert("Please enter an email."); return; }
        if (!feedbackInput) { alert("Please fill out the feedback field."); return; }
        
        event.preventDefault(); //allows javascript to handle submitting form details instead of HTML
        const subjectInput = document.querySelector("input[name='subject']");
                
        // sanitise inputs
        const sanitizedName = sanitizeInput(nameInput); 
        const sanitizedEmail = sanitizeEmail(emailInput);
        const sanitizedFeedback = sanitizeInput(feedbackInput);

        // validate email
        if (!validateEmail(sanitizedEmail)) { alert("Please enter a valid email address."); return; }
        subjectInput.value = "Feedback from " + sanitizedEmail; // Updates subject line with sanitised email

        form.submit();
    });
});

// Removes leading and trailing whitespace for formatting, and replaces potentially harmful characters like "<" & ">", replaces them with HTML encodings
function sanitizeInput(input) {
  input = input.trim();                                      
  input = input.replace(/</g, "&lt;").replace(/>/g, "&gt;");
  return input;
}

// remove harmful characters from email being sent to subject line, by only permitting the characters specified in .replace()
function sanitizeEmail(email) {
  email = email.trim(); 
  email = email.replace(/[^a-zA-Z0-9@._-]/g, "");
  return email;
}

// This looks incredibly complicated, but its just regex taken from here to filter for emails that follow these formatting guidelines https://regex101.com/r/3uvtNl/1
function validateEmail(email) {
  const re = /^((?:[A-Za-z0-9!#$%&'*+\-\/=?^_`{|}~]|(?<=^|\.)"|"(?=$|\.|@)|(?<=".*)[ .](?=.*")|(?<!\.)\.){1,64})(@)((?:[A-Za-z0-9.\-])*(?:[A-Za-z0-9])\.(?:[A-Za-z0-9]){2,})$/gm; 
  return re.test(email);
}

</script>

<h1>Mailing List</h1>
<div class="ml-embedded" data-form="PEpZNW"></div>
<br><br>

<h1>Feedback</h1>
<p>Your feedback is appreciated and useful. Feel free to leave a comment here, <br>
but please be specific with any issues you encounter so we can help to resolve them <br>
(for example, what page it occured on, what you tried, and so on). </p>

<form name="feedback" method="POST" netlify="" netlify-honeypot="bot-field">
  <p style="display: none;"><label>Don't fill this out if you're human: <input name="bot-field"></label></p>
  <input type="hidden" name="subject" value="Feedback from unknown">

  <label for="name">Name: </label>
  <br>
  <input type="text" name="name" required="">
  <br><br>
  
  <label for="email">E-mail: </label>
  <br>
  <input type="email" name="email" required="">
  <br><br>
  
  <label for="feedback">Feedback: </label>
  <br>
  <textarea rows="5" cols="50" placeholder="Your feedback" name="feedback" required=""></textarea>
  <br><br>

  <!-- Google reCAPTCHA Widget -->
  <div class="g-recaptcha" data-sitekey="6LeiTt4qAAAAAGaEQOUljIc9e3iqDz6eH9Te_lQr"></div>
  <br>

  <button type="submit">Submit</button>
</form>

<script src="https://www.google.com/recaptcha/api.js" async="" defer=""></script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../about.html">
<p>About</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../fullindex.html">
<p>Index</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../cookies.html">
<p>Cookie policy</p>
</a>
  </li>  
</ul>
    <div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../license.html">
<p>STARMAST © 2025 is licensed under CC BY-NC-SA 4.0.</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>