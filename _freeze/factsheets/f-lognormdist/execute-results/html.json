{
  "hash": "7573a1c95d4fcb6c1781c3ebfcfcc385",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Factsheet: Lognormal distribution\"\nauthor: Michelle Arnetta and Tom Coleman\nabstract-title: Summary\nabstract: A factsheet for the lognormal distribution.\nfilters: \n  - shinylive\nembed-resources: false\ncategories: \n  - Statistics\n---\n\n\n\n\n\n\n\n\n\n\n\n\n\n::: {.content-visible when-format=\"html\"}\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 740\n\nlibrary(shiny)\nlibrary(bslib)\nlibrary(ggplot2)\n\nui <- page_fluid(\n  title = \"Lognormal distribution calculator\",\n  \n  layout_columns(\n    col_widths = c(4, 8),\n    \n    # Left column - Inputs\n    card(\n      card_header(\"Parameters\"),\n      card_body(\n        numericInput(\"meanlog\", \"Log mean (μ):\", value = 0, step = 0.1),\n        numericInput(\"sdlog\", \"Log standard deviation (σ):\", value = 1, min = 0.01, step = 0.1),\n        hr(),\n        radioButtons(\"prob_type\", \"Probability to calculate:\",\n                    choices = list(\"P(X ≤ x)\" = \"less\", \n                                  \"P(X ≥ x)\" = \"greater\", \n                                  \"P(x ≤ X ≤ y)\" = \"between\"),\n                    selected = \"less\"),\n        conditionalPanel(\n          condition = \"input.prob_type == 'less'\",\n          sliderInput(\"x_less\", \"x value:\", min = 0, max = 10, value = 1, step = 0.1)\n        ),\n        conditionalPanel(\n          condition = \"input.prob_type == 'greater'\",\n          sliderInput(\"x_greater\", \"x value:\", min = 0, max = 10, value = 1, step = 0.1)\n        ),\n        conditionalPanel(\n          condition = \"input.prob_type == 'between'\",\n          sliderInput(\"x_lower\", \"Lower bound (x):\", min = 0, max = 10, value = 0.5, step = 0.1),\n          sliderInput(\"x_upper\", \"Upper bound (y):\", min = 0, max = 10, value = 2, step = 0.1)\n        )\n      )\n    ),\n    \n    # Right column - Plot\n    card(\n      card_header(\"Lognormal distribution plot\"),\n      card_body(\n        uiOutput(\"plot_title\"),\n        plotOutput(\"distPlot\", height = \"300px\")\n      )\n    )\n  ),\n  \n  # Bottom row - Results\n  card(\n    card_header(\"Results\"),\n    card_body(\n      textOutput(\"explanation\")\n    )\n  )\n)\n\nserver <- function(input, output, session) {\n  \n  # When parameters change, adjust the range of sliders\n  observe({\n    # For lognormal distribution, adjust slider based on parameters\n    meanlog <- input$meanlog\n    sdlog <- input$sdlog\n    \n    # Use a heuristic to determine a reasonable upper bound\n    # This captures most of the meaningful density\n    max_x <- min(qlnorm(0.995, meanlog, sdlog), 100)\n    \n    updateSliderInput(session, \"x_less\", max = max_x)\n    updateSliderInput(session, \"x_greater\", max = max_x)\n    updateSliderInput(session, \"x_lower\", max = max_x)\n    updateSliderInput(session, \"x_upper\", max = max_x)\n  })\n  \n  # Ensure that x_upper is always greater than or equal to x_lower\n  observe({\n    if (input$x_upper < input$x_lower) {\n      updateSliderInput(session, \"x_upper\", value = input$x_lower)\n    }\n  })\n  \n  # Display the plot title with distribution parameters\n  output$plot_title <- renderUI({\n    title <- sprintf(\"Lognormal(μ = %.2f, σ = %.2f)\", input$meanlog, input$sdlog)\n    tags$h4(title, style = \"text-align: center; margin-bottom: 15px;\")\n  })\n  \n  # Calculate the probability based on user selection\n  probability <- reactive({\n    if (input$prob_type == \"less\") {\n      prob <- plnorm(input$x_less, meanlog = input$meanlog, sdlog = input$sdlog)\n      explanation <- sprintf(\"P(X ≤ %.1f) = %.6f or %.4f%%\", \n                           input$x_less, prob, prob * 100)\n      return(list(prob = prob, explanation = explanation, type = \"less\", x = input$x_less))\n      \n    } else if (input$prob_type == \"greater\") {\n      prob <- 1 - plnorm(input$x_greater, meanlog = input$meanlog, sdlog = input$sdlog)\n      explanation <- sprintf(\"P(X ≥ %.1f) = %.6f or %.4f%%\", \n                           input$x_greater, prob, prob * 100)\n      return(list(prob = prob, explanation = explanation, type = \"greater\", x = input$x_greater))\n      \n    } else if (input$prob_type == \"between\") {\n      if (input$x_lower == input$x_upper) {\n        # For continuous distributions, P(X = a) = 0\n        prob <- 0\n      } else {\n        upper_prob <- plnorm(input$x_upper, meanlog = input$meanlog, sdlog = input$sdlog)\n        lower_prob <- plnorm(input$x_lower, meanlog = input$meanlog, sdlog = input$sdlog)\n        prob <- upper_prob - lower_prob\n      }\n      explanation <- sprintf(\"P(%.1f ≤ X ≤ %.1f) = %.6f or %.4f%%\", \n                           input$x_lower, input$x_upper, prob, prob * 100)\n      return(list(prob = prob, explanation = explanation, type = \"between\", \n                 lower = input$x_lower, upper = input$x_upper))\n    }\n  })\n  \n  # Display an explanation of the calculation\n  output$explanation <- renderText({\n    res <- probability()\n    return(res$explanation)\n  })\n  \n  # Generate the lognormal distribution plot\n  output$distPlot <- renderPlot({\n    # Get parameters\n    meanlog <- input$meanlog\n    sdlog <- input$sdlog\n    \n    # Determine a reasonable max for x-axis based on parameters\n    max_x <- min(qlnorm(0.995, meanlog, sdlog), 100)\n    \n    # Create data frame for plotting\n    x_values <- seq(0.01, max_x, length.out = 500)  # Avoid x=0\n    density_values <- dlnorm(x_values, meanlog = meanlog, sdlog = sdlog)\n    plot_df <- data.frame(x = x_values, density = density_values)\n    \n    # Create base plot\n    p <- ggplot(plot_df, aes(x = x, y = density)) +\n      geom_line(size = 1, color = \"darkgray\") +\n      labs(x = \"X\", y = \"probability density function\") +\n      theme_minimal() +\n      theme(panel.grid.minor = element_blank()) +\n      xlim(0, max_x)\n    \n    # Add shaded area based on selected probability type\n    res <- probability()\n    \n    if (res$type == \"less\") {\n      # Create data for the filled area\n      fill_x <- seq(0.01, res$x, length.out = 200)\n      fill_y <- dlnorm(fill_x, meanlog = meanlog, sdlog = sdlog)\n      fill_df <- data.frame(x = fill_x, density = fill_y)\n      \n      p <- p + geom_area(data = fill_df, aes(x = x, y = density), \n                        fill = \"#3F6BB6\", alpha = 0.6)\n      \n    } else if (res$type == \"greater\") {\n      # Create data for the filled area\n      fill_x <- seq(res$x, max_x, length.out = 200)\n      fill_y <- dlnorm(fill_x, meanlog = meanlog, sdlog = sdlog)\n      fill_df <- data.frame(x = fill_x, density = fill_y)\n      \n      p <- p + geom_area(data = fill_df, aes(x = x, y = density), \n                        fill = \"#3F6BB6\", alpha = 0.6)\n      \n    } else if (res$type == \"between\") {\n      # Create data for the filled area\n      fill_x <- seq(res$lower, res$upper, length.out = 200)\n      fill_y <- dlnorm(fill_x, meanlog = meanlog, sdlog = sdlog)\n      fill_df <- data.frame(x = fill_x, density = fill_y)\n      \n      p <- p + geom_area(data = fill_df, aes(x = x, y = density), \n                        fill = \"#3F6BB6\", alpha = 0.6)\n    }\n    \n    return(p)\n  })\n}\n\nshinyApp(ui = ui, server = server)\n```\n\n:::\n\n::: {.content-hidden when-format=\"html\"}\n\n![An example of the lognormal distribution with $\\mu = 3$ and $\\sigma = 0.5$.](./FiguresPNG/f-lognormaldist.png){width=\"80%\"}\n\n:::\n\n\n**Where to use:** The lognormal distribution is used to model continuous random variables with values that are both real and non-negative, wherein the logarithms of these variables follow a normal distribution. That is to say, if the random variable $X$ is lognormally distributed, then the random variable $Y = \\ln(X)$ is normally distributed (where $\\ln$ is the natural logarithm).\n\n**Notation:** $X \\sim \\textrm{Lognormal}(\\mu,\\sigma^2)$\n\n**Parameters:** As with the normal distribution, two numbers $\\mu$ and $\\sigma^2$ where:\n\n-   $\\mu$ is the expected value of the normally distributed random variable $Y = \\ln(X)$,\n-   $\\sigma^2$ is the variance of the normally distributed random variable $Y = \\ln(X)$.\n\n| Quantity | Value | Notes |\n|:--------|:----------------------------|:-------------------|\n| **Mean** | $\\mathbb{E}(X) = \\exp(\\mu+\\frac{\\sigma^2}{2})$ | $\\exp(y) = e^y$ |\n| **Variance** | $\\mathbb{V}(X) = [\\exp(\\sigma^2)-1]\\exp(2\\mu+\\sigma^2)$ | $\\exp(y) = e^y$ |\n| **PDF** | $\\mathbb{P}(X=x)=\\dfrac{1}{x\\sigma\\sqrt{2\\pi}}\\exp\\left(-\\dfrac{(\\ln(x)-\\mu)^2}{2\\sigma^2}\\right)$ | $\\exp(y) = e^y$ |\n| **CDF** | $\\displaystyle\\mathbb{P}(X\\leq x)=\\dfrac{1}{2}\\left[1+\\textrm{erf}\\left(\\dfrac{\\ln(x)-\\mu}{\\sigma\\sqrt{2}}\\right)\\right]$ | $\\textrm{erf}(x)$ is the error function of $x$ |\n\n**Example:** The logarithms of Cantor’s Confectionery’s stock prices follow a normal distribution. The mean of the stock prices’ natural logarithms is $8.01$, whereas the variance of the stock prices’ natural logarithms is $3$. This can be expressed as $X \\sim \\textrm{Lognormal}(8.01, 3)$, meaning the logarithm of the location parameter is $8.01$ and the logarithm of scale parameter is $3$.\n\n# Further reading {-}\n\n[This interactive element appears in Overview: Probability distributions. Please click this link to go to the guide.](../overviews/o-distributions.qmd)\n\n## Version history {-}\n\nv1.0: initial version created 04/25 by tdhc and Michelle Arnetta as part of a University of St Andrews VIP project.\n\n  - v1.1: moved to factsheet form and populated with material from [Overview: Probability distributions](../overviews/o-distributions.qmd) by tdhc.\n  \n[This work is licensed under CC BY-NC-SA 4.0.](https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1)\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}