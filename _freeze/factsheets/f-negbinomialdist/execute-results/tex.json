{
  "hash": "983173081852d1e644ac7a54ffd4da7f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Factsheet: Negative binomial distribution\"\nauthor: Michelle Arnetta and Tom Coleman\nabstract-title: Summary\nabstract: A factsheet for the negative binomial distribution.\nfilters: \n  - shinylive\nembed-resources: false\ncategories: \n  - Statistics\n---\n\n\n\n\n\n\n\n\n\n\n::: {.content-visible when-format=\"html\"}\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 850\n\nlibrary(shiny)\nlibrary(bslib)\nlibrary(ggplot2)\n\nui <- page_fluid(\n  title = \"Negative binomial distribution calculator\",\n  \n  layout_columns(\n    col_widths = c(4, 8),\n    \n    # Left column - Inputs\n    card(\n      card_header(\"Parameters\"),\n      card_body(\n        numericInput(\"r\", \"Number of successes (r):\", value = 5, min = 1, step = 1),\n        sliderInput(\"p\", \"Probability of success (p):\", min = 0.01, max = 0.99, value = 0.3, step = 0.01),\n        numericInput(\"max_x\", \"Maximum x to display:\", value = 20, min = 10, step = 5),\n        hr(),\n        radioButtons(\"prob_type\", \"Probability to calculate:\",\n                    choices = list(\"P(X ≤ x)\" = \"less\", \n                                  \"P(X ≥ x)\" = \"greater\", \n                                  \"P(x ≤ X ≤ y)\" = \"between\"),\n                    selected = \"less\"),\n        conditionalPanel(\n          condition = \"input.prob_type == 'less' || input.prob_type == 'greater'\",\n          sliderInput(\"x_value\", \"x value:\", min = 0, max = 20, value = 8, step = 1)\n        ),\n        conditionalPanel(\n          condition = \"input.prob_type == 'between'\",\n          sliderInput(\"x_lower\", \"Lower bound (x):\", min = 0, max = 20, value = 5, step = 1),\n          sliderInput(\"x_upper\", \"Upper bound (y):\", min = 0, max = 20, value = 12, step = 1)\n        )\n      )\n    ),\n    \n    # Right column - Plot\n    card(\n      card_header(\"Negative binomial distribution plot\"),\n      card_body(\n        uiOutput(\"plot_title\"),\n        plotOutput(\"distPlot\", height = \"300px\")\n      )\n    )\n  ),\n  \n  # Bottom row - Results\n  card(\n    card_header(\"Results\"),\n    card_body(\n      textOutput(\"explanation\")\n    )\n  )\n)\n\nserver <- function(input, output, session) {\n  \n  # Update the range of the sliders when max_x changes\n  observe({\n    updateSliderInput(session, \"x_value\", max = input$max_x)\n    updateSliderInput(session, \"x_lower\", max = input$max_x)\n    updateSliderInput(session, \"x_upper\", max = input$max_x)\n  })\n  \n  # Ensure that x_upper is always greater than or equal to x_lower\n  observe({\n    if (input$x_upper < input$x_lower) {\n      updateSliderInput(session, \"x_upper\", value = input$x_lower)\n    }\n  })\n  \n  # Display the plot title with distribution parameters\n  output$plot_title <- renderUI({\n    title <- sprintf(\"NegBin(r = %d, p = %.2f)\", input$r, input$p)\n    tags$h4(title, style = \"text-align: center; margin-bottom: 15px;\")\n  })\n  \n  # Calculate the probability based on user selection\n  probability <- reactive({\n    if (input$prob_type == \"less\") {\n      prob <- pnbinom(input$x_value, size = input$r, prob = input$p)\n      explanation <- sprintf(\"P(X ≤ %d) = %.4f or %.2f%%\", \n                            input$x_value, prob, prob * 100)\n      return(list(prob = prob, explanation = explanation, type = \"less\", x = input$x_value))\n      \n    } else if (input$prob_type == \"greater\") {\n      # For P(X ≥ x), we need 1 - P(X < x) = 1 - P(X ≤ x-1)\n      if (input$x_value == 0) {\n        prob <- 1  # P(X ≥ 0) is always 1\n      } else {\n        prob <- 1 - pnbinom(input$x_value - 1, size = input$r, prob = input$p)\n      }\n      explanation <- sprintf(\"P(X ≥ %d) = %.4f or %.2f%%\", \n                            input$x_value, prob, prob * 100)\n      return(list(prob = prob, explanation = explanation, type = \"greater\", x = input$x_value))\n      \n    } else if (input$prob_type == \"between\") {\n      if (input$x_lower == input$x_upper) {\n        # Exact probability for a single value\n        prob <- dnbinom(input$x_lower, size = input$r, prob = input$p)\n      } else {\n        # P(x_lower ≤ X ≤ x_upper) = P(X ≤ x_upper) - P(X < x_lower) = P(X ≤ x_upper) - P(X ≤ x_lower-1)\n        upper_prob <- pnbinom(input$x_upper, size = input$r, prob = input$p)\n        if (input$x_lower == 0) {\n          lower_prob <- 0\n        } else {\n          lower_prob <- pnbinom(input$x_lower - 1, size = input$r, prob = input$p)\n        }\n        prob <- upper_prob - lower_prob\n      }\n      explanation <- sprintf(\"P(%d ≤ X ≤ %d) = %.4f or %.2f%%\", \n                            input$x_lower, input$x_upper, prob, prob * 100)\n      return(list(prob = prob, explanation = explanation, type = \"between\", \n                 lower = input$x_lower, upper = input$x_upper))\n    }\n  })\n  \n  # Display an explanation of the calculation\n  output$explanation <- renderText({\n    res <- probability()\n    return(res$explanation)\n  })\n  \n  # Generate the negative binomial distribution plot\n  output$distPlot <- renderPlot({\n    # Create data frame for plotting\n    x_values <- 0:input$max_x\n    prob_mass <- dnbinom(x_values, size = input$r, prob = input$p)\n    df <- data.frame(x = x_values, probability = prob_mass)\n    \n    # Create base plot\n    p <- ggplot(df, aes(x = x, y = probability)) +\n      geom_col(fill = \"lightgray\", color = \"darkgray\", alpha = 0.7) +\n      labs(x = \"number of failures (X)\", y = \"probability mass function\") +\n      theme_minimal() +\n      theme(panel.grid.minor = element_blank()) +\n      scale_x_continuous(breaks = pretty(x_values, n = 10))\n    \n    # Add shaded area based on selected probability type\n    res <- probability()\n    \n    if (res$type == \"less\") {\n      highlight_x <- 0:min(res$x, input$max_x)\n      highlight_df <- df[df$x %in% highlight_x, ]\n      \n      p <- p + geom_col(data = highlight_df, aes(x = x, y = probability), \n                       fill = \"#3F6BB6\", color = \"darkgray\", alpha = 0.8)\n      \n    } else if (res$type == \"greater\") {\n      highlight_x <- res$x:input$max_x\n      highlight_df <- df[df$x %in% highlight_x, ]\n      \n      p <- p + geom_col(data = highlight_df, aes(x = x, y = probability), \n                       fill = \"#3F6BB6\", color = \"darkgray\", alpha = 0.8)\n      \n    } else if (res$type == \"between\") {\n      highlight_x <- res$lower:min(res$upper, input$max_x)\n      highlight_df <- df[df$x %in% highlight_x, ]\n      \n      p <- p + geom_col(data = highlight_df, aes(x = x, y = probability), \n                       fill = \"#3F6BB6\", color = \"darkgray\", alpha = 0.8)\n    }\n    \n    return(p)\n  })\n}\n\nshinyApp(ui = ui, server = server)\n```\n\n:::\n\n::: {.content-hidden when-format=\"html\"}\n\n![An example of the negative distribution with $r = 4$ and $p = 0.3$.](./FiguresPNG/f-negbinomialdist.png){width=\"80%\"}\n\n:::\n\n**Where to use:** The negative binomial distribution is often used to handle over-dispersed data, which means the variance exceeds the mean. It can serve as an alternative to the Poisson distribution, as the Poisson distribution assumes that the mean is equal to the variance. $X$ represents the number of trials required to reach the targeted number of successes $r$.\n\n**Notation:** $X \\sim \\textrm{NB}(r,p)$\n\n**Parameters:** Two numbers $r,p$ where:\n\n-   $r$ is an integer representing the targeted number of successes,\n-   $p$ is a real number representing the probability of success in a single trial (where $0 \\le p \\le 1$).\n\n| Quantity | Value | Notes |\n|:--------|:----------------------------|:-------------------|\n| **Mean** | $\\mathbb{E}(X) = \\dfrac{r(1-p)}{p}$ |  |\n| **Variance** | $\\mathbb{V}(X) = \\dfrac{r(1-p)}{p^2}$ |  |\n| **PMF** | $\\mathbb{P}(X=x)=\\dfrac{(x+r-1)!}{(r-1)!x!}(1-p)^xp^r$ |  |\n| **CDF** | $\\displaystyle\\mathbb{P}(X\\leq x)=\\sum^{x}_{i=1}\\frac{(x+r-1)!}{(r-1)!x!}(1-p)^xp^r$ |  |\n\n**Example:** You flip a coin multiple times, and the probability of getting ‘heads’ is $0.5$. You decide to stop flipping the coin once you get $3$ ‘heads’; these do not have to be consecutive. Taking ‘heads’ as a success, this can be expressed as $X \\sim \\textrm{NB}(3,0.5)$. It means the probability of success is $0.5$, and you will stop conducting trials after you reach $3$ successes.\n\n# Further reading {-}\n\nThis interactive element appears in [Overview: Probability distributions.](../overviews/o-distributions.qmd).\n\n## Version history {-}\n\nv1.0: initial version created 08/25 by tdhc.\n  \n[This work is licensed under CC BY-NC-SA 4.0.](https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1)\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}